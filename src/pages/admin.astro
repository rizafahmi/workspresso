---
import { db, Venue } from "astro:db";
import AdminLayout from "../layouts/AdminLayout.astro";

const venues = await db.select().from(Venue);
---

<AdminLayout title="Workspresso - Admin Dashboard">
	<div class="min-h-screen bg-neutral-50">
		<div class="bg-neutral-950 text-white p-6 border-b-8 border-amber-500">
			<div class="flex items-start justify-between mb-4">
				<div>
					<a href="/">
						<h1 class="text-3xl font-black tracking-tight mb-2">
							WORK<span class="text-amber-400">SPRESSO</span>
						</h1>
					</a>
					<div class="text-sm text-amber-400 font-bold">
						ADMIN DASHBOARD
					</div>
				</div>
				<div class="flex gap-2">
					<a
						href="/"
						class="text-xs bg-neutral-800 text-white px-3 py-2 font-bold hover:bg-neutral-700 transition-colors"
					>
						‚Üê BACK
					</a>
					<a
						href="/new"
						class="text-xs bg-amber-500 text-neutral-900 px-3 py-2 font-bold hover:bg-amber-400 transition-colors"
					>
						+ ADD VENUE
					</a>
				</div>
			</div>
		</div>

		<div class="p-6">
			<div class="bg-white border-4 border-neutral-900 shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] mb-6">
				<div class="bg-neutral-900 text-white p-4 font-bold text-lg">
					VENUE LIST ({venues.length} TOTAL)
				</div>
				<div class="overflow-x-auto">
					<table class="w-full">
						<thead>
							<tr class="bg-neutral-100 border-b-2 border-neutral-900">
								<th class="px-4 py-3 text-left font-black text-sm">ID</th>
								<th class="px-4 py-3 text-left font-black text-sm">NAME</th>
								<th class="px-4 py-3 text-left font-black text-sm">GRADE</th>
								<th class="px-4 py-3 text-left font-black text-sm">WIFI</th>
								<th class="px-4 py-3 text-left font-black text-sm">POWER</th>
								<th class="px-4 py-3 text-left font-black text-sm">NOISE</th>
								<th class="px-4 py-3 text-left font-black text-sm">SEATING</th>
								<th class="px-4 py-3 text-left font-black text-sm">SUMMARY</th>
								<th class="px-4 py-3 text-left font-black text-sm">SATISFACTION</th>
								<th class="px-4 py-3 text-left font-black text-sm">ACTIONS</th>
							</tr>
						</thead>
						<tbody>
							{
								venues.map((venue, index) => (
									<tr
										class={`border-b border-neutral-200 hover:bg-neutral-50 ${
											index % 2 === 0 ? "bg-white" : "bg-neutral-50"
										}`}
									>
										<td class="px-4 py-3 font-mono text-sm">{venue.id}</td>
										<td class="px-4 py-3">
											<div class="font-bold">{venue.name}</div>
											<div class="text-xs text-neutral-600 font-mono">
												{venue.vibe}
											</div>
										</td>
										<td class="px-4 py-3">
											<span
												class={`inline-block px-2 py-1 font-black text-sm ${
													venue.grade === "A"
														? "bg-emerald-100 text-emerald-800"
														: venue.grade === "B"
															? "bg-amber-100 text-amber-800"
															: "bg-orange-100 text-orange-800"
												}`}
											>
												{venue.grade}
											</span>
										</td>
										<td class="px-4 py-3 text-center font-mono text-sm">
											{venue.wifiScore}/5
										</td>
										<td class="px-4 py-3 text-center font-mono text-sm">
											{venue.powerScore}/5
										</td>
										<td class="px-4 py-3 text-center font-mono text-sm">
											{venue.noiseScore}/5
										</td>
										<td class="px-4 py-3 text-center font-mono text-sm">
											{venue.seatingScore}/5
										</td>
										<td class="px-4 py-3 text-sm text-neutral-600 max-w-xs break-words">
											{venue.summary || '-'}
										</td>
										<td class="px-4 py-3 text-center">
											{venue.satisfaction ? (
												<span
													class={`inline-block px-3 py-1 font-black text-sm uppercase ${
														venue.satisfaction === "awesome"
															? "bg-emerald-500 text-white border-2 border-emerald-700"
															: venue.satisfaction === "great"
																? "bg-emerald-100 text-emerald-800 border-2 border-emerald-600"
																: venue.satisfaction === "good"
																	? "bg-amber-100 text-amber-800 border-2 border-amber-600"
																	: venue.satisfaction === "ok"
																		? "bg-orange-100 text-orange-800 border-2 border-orange-600"
																		: venue.satisfaction === "bad"
																			? "bg-rose-100 text-rose-800 border-2 border-rose-600"
																			: "bg-rose-500 text-white border-2 border-rose-700"
													}`}
												>
													{venue.satisfaction}
												</span>
											) : (
												<span class="text-neutral-400">-</span>
											)}
										</td>
										<td class="px-4 py-3">
											<a
												href={`/venue/${venue.id}`}
												class="text-xs bg-neutral-900 text-white px-2 py-1 font-bold hover:bg-neutral-700 transition-colors inline-block"
											>
												VIEW
											</a>
										</td>
									</tr>
								))
							}
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
</AdminLayout>
